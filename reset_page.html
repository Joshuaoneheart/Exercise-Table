<!DOCTYPE html>
<html class="no-js">
    <head>
        <title>Admin Home Page</title>
        <!-- Bootstrap -->
        <!--bootstrap.min.css-->
        <link href="//drive.google.com/uc?id=17ompsephkLOP5aAZolEJYSMf9aN6FdZK&export=download" rel="stylesheet" media="screen">
        <!--bootstrap-responsive.min.css-->
        <link href="//drive.google.com/uc?id=1qNuaxOrnltFGBwox8f_TP5DsEiYoEeI_&export=download" rel="stylesheet" media="screen">
        <!--jquery.easy-pie-chart.css-->
        <link href="//drive.google.com/uc?id=10L_Y1oAV6w4nq740XtHWh6LirHRydM8X&export=download" rel="stylesheet" media="screen">
        <!--style.css-->
        <link href="//drive.google.com/uc?id=1x5TnbSM6F2GqyfsQlMEjmJW5Ftk9RmBB" rel="stylesheet" media="screen">
        <!--file upload css-->
        <link href="//drive.google.com/uc?id=1hA9GFyEy9G9h8CT-Q0oEDVtRBNNxnz_g" rel="stylesheet" media="screen">
        <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
        <!--[if lt IE 9]>
            <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
        <script src="//drive.google.com/open?id=1U0Lz7TYkyM3wZUuffNUMweu8pOZsTnYv"></script>
        <!--file upload js-->
        <script src="//drive.google.com/open?id=13aIZcG_GzbDk2DfZ8IrNWWds3Guuddfc"></script>
        <script>
        function show_toggle(item){
        if(item.parentElement.classList.contains("open")) item.parentElement.classList.remove("open");
        else item.parentElement.classList.add("open");
        }
        function alert_success(){
        var banner = document.getElementsByClassName("alert-success").item(0);
        if(banner.classList.contains("hidden")) banner.classList.remove("hidden");
        else banner.classList.add("hidden")
        }
        function upload(item, name){
        var form = document.forms['reset_form'];
        //上傳csv檔，若不是csv，跑出錯誤信息
        if(item.files[0].type != "application/vnd.ms-excel"){
        item.parentElement.getElementsByClassName("alert").item(0).classList.remove("hidden");
        form["reset_system_btn"].disabled = true;
        return -1;
        }
        var reader = new FileReader();
        var progressBar = item.parentElement.getElementsByClassName("progress").item(0);
        progressBar.classList.remove("hidden");
        reader.onload = event => {
        // 取得檔案完整內容
        progressBar.classList.add("hidden");
        if(typeof(form[name]) != 'undefined' && form[name] != null){
        form.removeChild(form[name]);
        }
        var input = document.createElement("input");
        input.type = "hidden";
        input.value = event.target.result;
        input.name = name;
        form.appendChild(input);
        var resident = form['resident'];
        var problem = form['problem'];
        //確認是否都有檔案
        if((typeof(resident) != 'undefined' && resident != null) &&
        (typeof(problem) != 'undefined' && problem != null)){
          form["reset_system_btn"].disabled = false;
        }
        else form["reset_system_btn"].disabled = true;
        //console.log(event.target.result);
        };
        reader.onprogress = function (evt) {
        // 確定 evt 是否為 ProgressEvent
        if (evt.lengthComputable) {
        // 計算百分比
        let percentLoaded = Math.round((evt.loaded / evt.total) * 100);
        //更新進度條
        progressBar.style.width = percentLoaded + "%";
        // 注意：這裡的百分比的數字不會到 100
        console.log(percentLoaded);
        }
        };
        var text = reader.readAsText(item.files[0]);      
      }
      function reset_system(item){
         var check = confirm("確定重置系統嗎?");
         if(!check) return false;
         var form = document.forms['reset_form'];
         var resident = form['resident'];
         var problem = form['problem'];        
         google.script.run.withSuccessHandler(function(res){
           switch(res){
           case 0:
           document.getElementById("resident_alert").classList.add("hidden");
           document.getElementById("problem_alert").classList.add("hidden");
           alert("重置成功");
           break;
           case -1:
            document.getElementById("resident_alert").classList.remove("hidden");
            alert("重置失敗");
           break;
           case -2:
            document.getElementById("problem_alert").classList.remove("hidden");
            alert("重置失敗");
           break;
           }
         }).withFailureHandler(alert("系統錯誤!! 請聯繫管理員 ")).reset(resident.value, problem.value);
      }
        </script>
    </head>
    
    <body>
        <div class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container-fluid">
                    <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                     <span class="icon-bar"></span>
                    </a>
                    <a class="brand" href="#">Exercise Table</a>
                    <div class="nav-collapse collapse">
                        <ul class="nav pull-right">
                            <li class="dropdown">
                                <a href="#" role="button" class="dropdown-toggle" data-toggle="dropdown"> <i class="icon-user"></i> Vincent Gabriel <i class="caret"></i>

                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a tabindex="-1" href="#">Profile</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a tabindex="-1" href="login.html">Logout</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <ul class="nav">
                            <li class="active">
                                <a href="#">Dashboard</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" data-toggle="dropdown" class="dropdown-toggle">Settings <b class="caret"></b>

                                </a>
                                <ul class="dropdown-menu" id="menu1">
                                    <li>
                                        <a href="#">Tools <i class="icon-arrow-right"></i>

                                        </a>
                                        <ul class="dropdown-menu sub-menu">
                                            <li>
                                                <a href="#">Reports</a>
                                            </li>
                                            <li>
                                                <a href="#">Logs</a>
                                            </li>
                                            <li>
                                                <a href="#">Errors</a>
                                            </li>
                                        </ul>
                                    </li>
                                    <li>
                                        <a href="#">SEO Settings</a>
                                    </li>
                                    <li>
                                        <a href="#">Other Link</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a href="#">Other Link</a>
                                    </li>
                                    <li>
                                        <a href="#">Other Link</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">Content <i class="caret"></i>

                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a tabindex="-1" href="#">Blog</a>
                                    </li>
                                    <li>
                                        <a tabindex="-1" href="#">News</a>
                                    </li>
                                    <li>
                                        <a tabindex="-1" href="#">Custom Pages</a>
                                    </li>
                                    <li>
                                        <a tabindex="-1" href="#">Calendar</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li>
                                        <a tabindex="-1" href="#">FAQ</a>
                                    </li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" role="button" class="dropdown-toggle" data-toggle="dropdown">Users <i class="caret"></i>

                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <a tabindex="-1" href="#">User List</a>
                                    </li>
                                    <li>
                                        <a tabindex="-1" href="#">Search</a>
                                    </li>
                                    <li>
                                        <a tabindex="-1" href="#">Permissions</a>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                    <!--/.nav-collapse -->
                </div>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row-fluid">
                <div class="span3" id="sidebar">
                    <ul class="nav nav-list bs-docs-sidenav nav-collapse collapse">
                        <li>
                            <a href="#" onClick="window.open('https://script.google.com/macros/s/AKfycbzJwl9NTOszYoQL-8yjLWcxHD28vEf0X8Fhf-iDch4/dev?page=notification')"><i class="icon-chevron-right"></i> 公告</a>
                        </li>
                        <li>
                            <a href="//drive.google.com/open?id=1UHbM2snEH_7afLGu3kk8WU338N2YdgO-"><i class="icon-chevron-right"></i> 總覽</a>
                        </li>
                        <li>
                            <a href="//drive.google.com/open?id=1ZY2I-1GtNqL9woVa26nsrx3C3mFzCzm7"><i class="icon-chevron-right"></i> 活力組操練情形</a>
                        </li>
                        <li>
                            <a href="//drive.google.com/open?id=1kaMiOoYyydVFDI__bpgG2wM4HIHT2bGc"><i class="icon-chevron-right"></i> 個人操練情形</a>
                        </li>
                        <li>
                            <a href="//drive.google.com/open?id=1Mtyp2hxpAg2O7A0gHld3flP309hnoNyp"><i class="icon-chevron-right"></i> 修改住戶名冊</a>
                        </li>
                        <li>
                            <a href="//drive.google.com/open?id=1kSy7Ql0MZQhNfCZVz-qD8glCIP8NYUPP"><i class="icon-chevron-right"></i> 修改表單</a>
                        </li>
                        <li>
                            <a href="//drive.google.com/open?id=1XKBdJXbyU9BXH5cS8BWLjvIJguWpjRhN"><i class="icon-chevron-right"></i> 表單預覽</a>
                        </li>
                        <li class="active">
                            <a href="#" onClick="window.open('https://script.google.com/macros/s/AKfycbzJwl9NTOszYoQL-8yjLWcxHD28vEf0X8Fhf-iDch4/dev?page=reset')"><i class="icon-chevron-right"></i> 系統設定</a>
                        </li>
                        <li>
                            <a href="#"><span class="badge badge-success pull-right">731</span> 行事曆</a>
                        </li>
                        <li>
                            <a href="#"><span class="badge badge-success pull-right">812</span> 系統操作指引</a>
                        </li>
                        <li>
                            <a href="#"><span class="badge badge-info pull-right">27</span> 聯絡管理員</a>
                        </li>
                    </ul>
                </div>
                
                    <!--/span-->
                <div class="span9" id="content">
                    <div class="row-fluid">
                        <div class="alert alert-success hidden">
							<button type="button" onClick="alert_success()" class="close" data-dismiss="alert">&times;</button>
                            <h4>Success</h4>
                        	The operation completed successfully</div>
                        	<div class="navbar">
                            	<div class="navbar-inner">
	                                <ul class="breadcrumb">
	                                    <i class="icon-chevron-left hide-sidebar"><a href='#' title="Hide Sidebar" rel='tooltip'>&nbsp;</a></i>
	                                    <i class="icon-chevron-right show-sidebar" style="display:none;"><a href='#' title="Show Sidebar" rel='tooltip'>&nbsp;</a></i>
	                                    <li>
	                                        <a href="#">Dashboard</a> <span class="divider">/</span>	
	                                    </li>
	                                    <li>
	                                        <a href="#">Settings</a> <span class="divider">/</span>	
	                                    </li>
	                                    <li class="active">Tools</li>
	                                </ul>
                            	</div>
                        	</div>
                    	</div>
                    <div class="row-fluid">
                        <!-- block -->
                        <div class="block">
                            <div class="navbar navbar-inner block-header">
                                <div class="muted pull-left">系統狀態</div>
                            </div>
                            <div class="block-content">
                            <div class="btn-group">
                            <button data-toggle="dropdown" class="btn dropdown-toggle" onClick="show_toggle(this)">
                            <font id="enabled"></font>
                            <script type="text/javascript">
                            google.script.run.withSuccessHandler(
                            function(res){
                            if(res) document.getElementById("enabled").innerHTML = "開啟 ";
                            else document.getElementById("enabled").innerHTML = "關閉 ";
                            }).get_enabled()
                            </script> 
                            <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu">
                            <li><a onClick="if(document.getElementById('enabled').innerHTML != '開啟 '){
                            google.script.run.withSuccessHandler().reboot();
                            document.getElementById('enabled').innerHTML = '開啟 ';
                            alert_success()
                            this.parentElement.parentElement.parentElement.classList.remove('open');}"  href="#">開啟</a></li>
                            <li><a onClick="if(document.getElementById('enabled').innerHTML != '關閉 '){
                            google.script.run.withSuccessHandler().shutdown();
                            document.getElementById('enabled').innerHTML = '關閉 ';
                            alert_success()}
                            this.parentElement.parentElement.parentElement.classList.remove('open');"  href="#">關閉</a></li>
                            </ul>
                            </div>
                            </div>
                        </div>
                        <!-- /block -->
                    </div>
                    <div class="row-fluid">
                        <!-- block -->
                        <div class="block">
                            <div class="navbar navbar-inner block-header">
                                <div class="muted pull-left">系統重置</div>
                            </div>
                            <div class="block-content">
                            
                            <form name="reset_form" class="form-horizontal" onSubmit="return false;">
                                      <fieldset>
                                        <div class="alert alert-info">
										<button class="close" data-dismiss="alert" onClick="this.parentElement.remove()">×</button>
										<strong>Info!</strong> 請確保上傳檔案格式正確無誤，參照 "系統操作指引"
                                        </div>
                                        <div class="control-group">
                                          <label class="control-label" for="focusedInput">住戶名單</label>
                                          <div class="controls">
                                            <input type="file" id="file-upload" onChange="upload(this,'resident')" accept=".csv">
                                          <div class="progress hidden">
											<div style="width: 0%;" class="bar"></div>
                                          </div>
                                          <div class="alert alert-error alert-block hidden" id="resident_alert">
										<a class="close" data-dismiss="alert" onClick="this.parentElement.classList.add('hidden')">×</a>
										<h4 class="alert-heading">Error!</h4>
										檔案格式錯誤
									</div>
                                          </div>
                                        </div>
                                        <div class="control-group">
                                          <label class="control-label" for="disabledInput">表單問題列表</label>
                                          <div class="controls">
                                            <input type="file" id="file-upload" onChange="upload(this,'problem')" accept=".csv">
                                            <div class="progress hidden">
											<div style="width: 0%;" class="bar"></div>
                                            </div>
                                            <div class="alert alert-error alert-block hidden" id="problem_alert">
										<a class="close" data-dismiss="alert" onClick="this.parentElement.classList.add('hidden')">×</a>
										<h4 class="alert-heading">Error!</h4>
										檔案格式錯誤
									</div>
                                          </div>
                                        </div>
                                        <div class="form-actions">
                                          <button name="reset_system_btn" type="submit" onClick="reset_system(this)" disabled="true" class="btn btn-primary">Reset System</button>
                                          <button type="reset" class="btn" onClick="var form = document.forms['reset_form'];form['reset_system_btn'].disabled = true;form.removeChild(form['resident']);form.removeChild(form['problem']);">Cancel</button>
                                        </div>
                                      </fieldset>
                                    </form>
                        </div>
                        <!-- /block -->
                    </div>
                    </div>
            </div>
            <hr>
            <footer>
                <p>&copy; Vincent Gabriel 2013</p>
            </footer>
        </div>
        <!--/.fluid-container-->
        <script src="//drive.google.com/open?id=1-Pw-CoFlQRZHPyprkz1BZCWLBm0-Dvi3"></script>
        <script src="//drive.google.com/open?id=1QrJDYI6O6FJVw44hmTJdcLdU3IN5Vj3E"></script>
        <script src="//drive.google.com/open?id=1TF87wUXakKSai5tcjZjw37OMRoDojIKG"></script>
        <script src="//drive.google.com/open?id=1NNuggUWnF0GzolbdosmfxbQ0sRvaHiC7"></script>
        <script>
        $(function() {
            // Easy pie charts
            $('.chart').easyPieChart({animate: 1000});
        });
        </script>
    </body>

</html>