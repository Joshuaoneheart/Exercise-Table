<!DOCTYPE html>
<html lang="tw">
    <head>
        <title></title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script>
        function findCode(){
            var url = google.script.url;
            url.getLocation(function (location){
            getToken(location.parameters["code"]);
            });
        }
        function err(err){
            alert(err);
        }
        function save(token){
                var form = document.getElementById("info");
                var name = form["yourName"]["value"];
                var group = form["yourGroup"]["value"];
                var gender = form["yourGender"]["value"];
                var residence = form["yourResidence"]["value"];
                google.script.run.withFailureHandler(err).withSuccessHandler(
                function(res){
                    switch(res){
                    case 1:
                        alert("註冊成功!\n請關閉網頁");
                    break;
                    case -1:
                        alert("該住戶已存在");
                    break;
                    case -2:
                        alert("住處不存在");
                    break;
                    case -3:
                        alert("活力組不存在");
                    break;
                    }
                }).addResident(name, residence, gender, group, token);
        }
        function getToken(code) {
            var form = document.getElementById("info");
            google.script.run.withFailureHandler(err).withSuccessHandler(save).sendRequest(code);
        }
        function refresh(index){
           refreshGroup(index);
           refreshResidence(index);
        }
        function refreshResidence(index){
           var residence = new Array();
            //弟兄的住處
            residence[0] = ["四樓弟兄之家","溫州公園弟兄之家","舊公館弟兄之家","頂好弟兄之家"];
            //姊妹的住處
            residence[1] = ["五樓姊妹之家","新生姊妹之家","新生二姊妹之家","新公館姊妹之家"];
           for(var i=0;i<residence[index].length;i++){
               document.resident.yourResidence.options[i]=new Option(residence[index][i], residence[index][i]);	// 設定新選項
               document.resident.yourResidence.length=residence[index].length;	// 刪除多餘的選項
               }
        }
        function refreshGroup(index){
           var group = new Array();
           //弟兄的團體
           group[0] = ["A1","A2","A3","B1","C1","C2","D1","D2","D3"];
           //姊妹的團體
           group[1] = ["A1","A2","B1","C1","C2","D1","D2"];
           for(var i=0;i<group[index].length;i++){
               document.resident.yourGroup.options[i]=new Option(group[index][i], group[index][i]);	// 設定新選項
               document.resident.yourGroup.length=group[index].length;	// 刪除多餘的選項
           }
        }
    </script>
    </head>
    <body>
        <form name = "resident" id = "info" method = "post" onsubmit = findCode()>
            請輸入你的名字：<input type = "text" name = "yourName">
            <select name="yourGender" onChange="refresh(this.selectedIndex)">
               　<option value="弟兄">弟兄/Brother</option>
               　<option value="姊妹">姊妹/Sister</option>
            </select>
            <br>
            你的身分是：
            <select name="identification">
                 <option value="resident">一般住戶/Resident</option>
                 <option value="serving one">服事者/Serving one</option>
               　<option value="administrator">系統管理者/administrator</option>
            </select>
            <br>
            請選擇活力組：
            <select name="yourGroup">
               　<option value="">請先選取弟兄或姊妹</option>
            </select>
            <br>
            請選擇住處：
            <select name="yourResidence">
               　<option value="">請先選取弟兄或姊妹</option>
            </select>
            <br>
            <input type = "submit" value = "送出">
        </form>
    </body>
</html>
